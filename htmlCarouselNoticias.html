<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carousel Noticias</title>
  <style>
    .noticias_carusel {
      position: relative;
      width: 75vw;
      overflow: hidden;
      border: solid 1px #ccc;
    }

    .carusel_container {
      display: flex;
      transition: transform 0.5s ease;
    }

    .carusel_item {
      min-width: 100%;
      box-sizing: border-box;
      display: flex;
      align-items: center;
    }

    .carusel_imagen {
      min-width: 400px;
      max-width: 400px;
      max-height: 300px;
      overflow: hidden;
    }

    .carusel_imagen img {
      max-width: 400px;
      max-height: 300px;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .carusel_contenido {
      padding: 10px;
      text-align: left;
      border: solid 1px #ccc;
      flex: 1;
    }

    .carusel_contenido h3 {
      font-size: 1.5em;
      margin: 0;
    }

    .carusel_contenido p {
      margin: 0;
    }

    .carusel_contenido .date-views {
      font-size: 0.8em;
      color: gray;
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
    }

    .prev,
    .next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2rem;
      cursor: pointer;
      z-index: 10;
      background-color: rgba(0, 0, 0, 0.1);
    }

    .prev {
      left: 10px;
    }

    .next {
      right: 10px;
    }

    @media (min-width: 601px) and (max-width: 1024px) {
      .carusel_item {
        flex-direction: column;
        align-items: center;
      }

      .carusel_contenido h3 {
        font-size: 1.3em;
      }

      .carusel_contenido p {
        font-size: 1.1em;
      }

      .carusel_imagen img {
        max-width: 350px;
        max-height: 250px;
      }

      .carusel_imagen {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .prev,
      .next {
        padding: 5px;
        top: 20%;
      }
    }

    @media (max-width: 600px) {
      .carusel_item {
        flex-direction: column;
        align-items: center;
      }

      .carusel_contenido h3 {
        font-size: 1.2em;
      }

      .carusel_contenido p {
        font-size: 1em;
      }

      .prev,
      .next {
        padding: 5px;
        top: 20%;
      }

      .carusel_imagen img {
        max-width: 300px;
        max-height: 200px;
      }

      .carusel_imagen {
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }
  </style>
</head>

<body>
  <div class="noticias_carusel">
    <div class="prev">&lArr;</div>
    <div class="carusel_container">
      
      
      
    </div>
    <div class="next">&rArr;</div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    jQuery(document).ready(function ($) {
      var currentIndex = 0;
      var items = $(".carusel_item");
      var itemAmt = items.length;
      var container = $(".carusel_container");

      /**
       * Funcion para obtener las entradas de la pagina y mostrarlas en el carusel
       */
      function obtener_entradas() {
        $.ajax({
          url: "https://renalida.com/wp-json/wp/v2/posts",
          type: "GET",
          success: function (data) {
            data.forEach((post) => {

              
              if (chequear_categoria(post, 'category-noticias')) { //si la entrada tiene la categoria 'category-noticias'
                //console.log(post);

                var imagen = obtener_imagen(post);
                var fecha = obtener_fecha(post);
                var titulo = obtener_titulo(post);
                var excerpt = obtener_excerpt(post);
                var link = obtener_link(post);
                /*
                console.log(titulo);
                console.log(excerpt);
                console.log(imagen);
                console.log(fecha);
                console.log(link);
                */

                var item = crear_elemnto_html(imagen, titulo, excerpt, fecha, link);
                container.append(item);
                itemAmt += 1;
              }

            });

          },
          error: function (error) {
            console.log('Error con la obtencion de las entradas' ,error);
          },
        });
      }

      /**
       * Funcion para crear un elemento html con la informacion de la entrada
       * @param {string} imagen 
       * @param {string} titulo 
       * @param {string} excerpt 
       * @param {string} fecha 
       * @param {string} link 
       * @returns {object} elemento html
       */
      function crear_elemnto_html(imagen, titulo, excerpt, fecha, link){
        var item = document.createElement('div');
        item.classList.add('carusel_item');

        var imagen_div = document.createElement('div');
        imagen_div.classList.add('carusel_imagen');
        var imagen_img = document.createElement('img');
        imagen_img.src = imagen;
        imagen_div.appendChild(imagen_img);

        var contenido_div = document.createElement('div');
        contenido_div.classList.add('carusel_contenido');
        var titulo_h3 = document.createElement('h3');
        titulo_h3.textContent = titulo;
        var fecha_div = document.createElement('div');
        fecha_div.classList.add('date-views');
        var fecha_span = document.createElement('span');
        fecha_span.textContent = fecha;
        fecha_div.appendChild(fecha_span);
        var excerpt_p = document.createElement('p');
        excerpt_p.textContent = excerpt;
        var link_a = document.createElement('a');
        link_a.href = link;
        link_a.textContent = 'Leer MÃ¡s';
        contenido_div.appendChild(titulo_h3);
        contenido_div.appendChild(fecha_div);
        contenido_div.appendChild(excerpt_p);
        contenido_div.appendChild(link_a);

        item.appendChild(imagen_div);
        item.appendChild(contenido_div);

        return item;
      }

      /**
       * Funcion para chequear si la entrada tiene una categoria
       * @param {object} post 
       * @param {string} categoria_a_chequear 
       * @returns {boolean} true si la entrada tiene la categoria, false si no
       */
      function chequear_categoria(post, categoria_a_chequear) {
        var flag = false;
        post.class_list.forEach((categoria) => {
          if (categoria_a_chequear === categoria) {
            flag = true;
          }
        })
        return flag;
      }

      /**
       * Funcion para obtener el link de la entrada
       * @param {object} post 
       * @returns {string} link de la entrada
       */
      function obtener_link(post) {
        var link = post.link;
        return link;
      }

      /**
       * Funcion para obtener el excerpt de la entrada filtrando las etiquetas html
       * @param {object} post 
       * @returns {string} excerpt de la entrada
       */
      function obtener_excerpt(post) {
        var excerpt = post.excerpt.rendered;
        var nuevoExcerpt = excerpt.replace(/<\/?p>/g, "");
        nuevoExcerpt = nuevoExcerpt.replace("[&hellip;]", "...");
        console.log(nuevoExcerpt);
        return nuevoExcerpt;
      }

      /**
       * Funcion para obtener el titulo de la entrada
       * @param {object} post 
       * @returns {string} titulo de la entrada
       */
      function obtener_titulo(post) {
        var titulo = post.title.rendered;
        return titulo;
      }

      /**
       * Funcion para obtener la imagen de la entrada
       * @param {object} post 
       * @returns {string} url de la imagen
       */
      function obtener_imagen(post) {
        if (post.yoast_head_json.og_image && post.yoast_head_json.og_image.length > 0) //si existe og_image y og_image tiene al menos un elemento
        {
          var imagen = post.yoast_head_json.og_image[0].url;//obtener la url de la imagen
        } else {
          var imagen = 'https://via.placeholder.com/400x300';//imagen por defecto
        }
        return imagen;
      }

      /**
       * Funcion para obtener la fecha de la entrada
       * @param {object} post 
       * @returns {string} fecha de la entrada
       */
      function obtener_fecha(post) {
        var fecha = new Date(post.date).toLocaleDateString('es-ES', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        return fecha;
      }

      /**
       * Funcion para rotar los items del carusel
       */
      function rotar_items() {
        var item = $(".carusel_item").eq(currentIndex);
        var position = -currentIndex * 100 + "%";
        container.css("transform", "translateX(" + position + ")");
      }
      /**
       * Evento para rotar los items hacia la derecha
       */
      $(".next").click(function () {
        currentIndex += 1;
        if (currentIndex > itemAmt - 1) {
          currentIndex = 0;
        }
        rotar_items();
      });
      /**
       * Evento para rotar los items hacia la izquierda
       */
      $(".prev").click(function () {
        currentIndex -= 1;
        if (currentIndex < 0) {
          currentIndex = itemAmt - 1;
        }
        rotar_items();
      });

      obtener_entradas();
      rotar_items();
    });
  </script>
</body>

</html>